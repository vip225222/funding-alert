        ws.onclose = () => location.reload();

        // Mobile <!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delta ±0.50% Funding Alert</title>
    <style>
        body {font-family: system-ui; background: #000; color: #0f0; margin:0; padding:10px;}
        h1 {text-align:center; color:#0f0; margin:10px;}
        #status {text-align:center; font-size:18px; font-weight:bold; padding:10px;}
        .on {color:#0f0;}
        .off {color:#f00;}
        table {width:100%; border-collapse:collapse; margin-top:10px; background:#111;}
        th, td {padding:12px; text-align:center; border-bottom:1px solid #333;}
        th {background:#222;}
        .pos {color:#0f0; font-weight:bold; font-size:1.3em;}
        .neg {color:#f00; font-weight:bold; font-size:1.3em;}
        #count {position:fixed; top:15px; right:15px; background:#f00; color:#fff; width:60px; height:60px; border-radius:50%; font-size:24px; line-height:60px; display:none; z-index:99;}
        #time {text-align:center; margin:10px; color:#888; font-size:14px;}
        #error {color: #f00; text-align: center; display: none;}
    </style>
</head>
<body>
    <h1>±0.50% Funding Alert [LIVE]</h1>
    <div id="status" class="off">Connecting...</div>
    <div id="error"></div>
    <div id="count">0</div>

    <table id="tbl">
        <thead><tr><th>Coin</th><th>Funding</th><th>Time</th></tr></thead>
        <tbody><tr><td colspan="3">Data aa raha hai...</td></tr></tbody>
    </table>
    <div id="time">Kabhi nahi</div>

    <audio id="beep" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" preload="auto"></audio>

    <script>
        // Changed to global server for better connection
        const ws = new WebSocket('wss://websocket.delta.exchange');
        const tbl = document.querySelector('#tbl tbody');
        const stat = document.getElementById('status');
        const cnt = document.getElementById('count');
        const beep = document.getElementById('beep');
        const timeDiv = document.getElementById('time');
        const errorDiv = document.getElementById('error');

        let rates = {};
        let alreadyAlerted = new Set();

        ws.onopen = () => {
            stat.textContent = "LIVE DATA ON ✅";
            stat.className = "on";
            errorDiv.style.display = 'none';
            ws.send(JSON.stringify({"type":"subscribe","channel":"funding_rates"}));
            console.log('WebSocket connected!');
        };

        ws.onmessage = (e) => {
            try {
                const msg = JSON.parse(e.data);
                if (msg.channel !== "funding_rates") return;

                let newAlert = false;
                const payload = Array.isArray(msg.payload) ? msg.payload : [msg.payload];
                payload.forEach(p => {
                    if (!p.symbol || !p.funding_rate) return;
                    const sym = p.symbol.replace("USDT","").replace("PERP","");
                    const rate = parseFloat(p.funding_rate);
                    const t = new Date(p.timestamp*1000).toLocaleTimeString('en-IN');

                    rates[sym] = {rate, t};

                    if (Math.abs(rate) >= 0.005) { // 0.50%
                        if (!alreadyAlerted.has(sym)) {
                            alreadyAlerted.add(sym);
                            newAlert = true;
                        }
                    } else {
                        alreadyAlerted.delete(sym);
                    }
                });

                if (newAlert) {
                    beep.play().catch(err => console.log('Sound error:', err));
                    cnt.textContent = alreadyAlerted.size;
                    cnt.style.display = "block";
                }

                showTable();
                timeDiv.textContent = "Update: " + new Date().toLocaleString('hi-IN');
            } catch (err) {
                console.error('Message parse error:', err);
            }
        };

        ws.onerror = (err) => {
            stat.textContent = "Connection Error! Reload karo...";
            stat.className = "off";
            errorDiv.textContent = "WebSocket error: Server busy? Try again in 1 min.";
            errorDiv.style.display = 'block';
            console.error('WebSocket error:', err);
        };

        ws.onclose = (event) => {
            stat.textContent = "Disconnected! Reconnecting...";
            stat.className = "off";
            errorDiv.style.display = 'none';
            if (event.code !== 1000) {
                setTimeout(() => location.reload(), 3000); // Auto reconnect after 3 sec
            }
        };

        function showTable() {
            const list = Object.entries(rates)
                .filter(([s, d]) => Math.abs(d.rate) >= 0.005)
                .sort((a,b) => Math.abs(b[1].rate) - Math.abs(a[1].rate));

            tbl.innerHTML = "";
            if (list.length === 0) {
                tbl.innerHTML = "<tr><td colspan='3'>Abhi koi coin ±0.50% pe nahi hai</td></tr>";
                cnt.style.display = "none";
                return;
            }

            list.forEach(([sym, d]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${sym}</td>
                                <td class="${d.rate>0?'pos':'neg'}">${(d.rate*100).toFixed(4)}%</td>
                                <td>${d.t}</td>`;
                tbl.appendChild(tr);
            });
        }

        // Mobile screen hamesha on rahe
        if ("wakeLock" in navigator) {
            navigator.wakeLock.request("screen").catch(()=>{});
        }
    </script>
</body>
</html>screen hamesha on rahe
        if ("wakeLock" in navigator) {
            navigator.wakeLock.request("screen").catch(()=>{});
        }
    </script>
</body>
</html>
